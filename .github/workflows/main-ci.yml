name: CI with Reusable Workflows
on:
  push:
    branches: master  # ${{github.ref_name}} not allowed here.
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'

jobs:
  generate-matrix-tuple:
    uses: ./.github/workflows/generate-matrix.yml # Call the matrix-generating workflow
  
  build-conda-pkg:
    needs: generate-matrix-tuple # Ensure matrix generation completes first
    uses: ./.github/workflows/build-conda-pkg.yml # Call the matrix-generating workflow
    secrets: inherit
    with:
      matrix_json: ${{ needs.generate-matrix-tuple.outputs.matrix }}

  # ref: ${{ github.event.pull_request.head.ref }}
  #display_final_output:
  #  needs: build-conda-pkg
  #  runs-on: ubuntu-latest
  #  steps:
  #    - name: Display final output
  #      run: |
  #        echo "The final output from job 3 is: ${{ needs.build-conda-pkg.outputs.conda-pkg}}"
